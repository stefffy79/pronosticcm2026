<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor CM 2026 - Mobile Optimized</title>
    <style>
        /* RESET »òI BAZƒÇ */
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; margin: 10px; padding: 0; }
        
        .container { 
            max-width: 1200px; 
            margin: auto; 
            background: white; 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-x: hidden; /* √émpiedicƒÉ scroll-ul orizontal pe containerul principal */
        }

        h1 { color: #1e3799; text-align: center; font-size: 1.5rem; }
        h2, h3 { color: #1e3799; margin-top: 10px; font-size: 1.2rem; }

        .section { 
            margin-bottom: 20px; 
            padding: 15px; 
            border: 1px solid #dcdde1; 
            border-radius: 10px; 
            background-color: #fff; 
        }
        
        /* GRILA ADMINISTRARE - REPARATƒÇ PENTRU MOBIL */
        .admin-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
        }

        /* FLEXBOX PENTRU INPUT-URI - REPARAT */
        .input-group-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .input-box {
            border: 1px solid #eee; 
            padding: 15px; 
            border-radius: 8px; 
            flex: 1; 
            min-width: 280px; /* Previne √Ænghesuirea prea tare */
        }

        /* TABELE RESPONSIVE */
        .table-wrapper {
            width: 100%;
            overflow-x: auto; /* Permite scroll doar pe tabel dacƒÉ e prea lat */
            -webkit-overflow-scrolling: touch;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 10px; 
            font-size: 0.85rem; 
        }

        th, td { border: 1px solid #dcdde1; padding: 8px; text-align: center; }
        th { background-color: #4a69bd; color: white; }

        /* BUTOANE */
        button { 
            background-color: #38ada9; 
            color: white; 
            padding: 10px 12px; 
            border: none; 
            cursor: pointer; 
            border-radius: 5px; 
            font-weight: bold; 
            width: 100%; /* Butoane pe toatƒÉ lƒÉ»õimea pe mobil pentru u»ôurin»õƒÉ */
            margin: 5px 0;
        }

        .btn-danger { background-color: #eb4d4b; }
        .btn-export { background-color: #f39c12; }

        input, select { 
            padding: 8px; 
            border: 1px solid #b2bec3; 
            border-radius: 4px; 
            width: 100%; /* Input-urile ocupƒÉ r√¢ndul lor */
            margin-bottom: 10px;
        }

        input[type="number"] { width: 60px; display: inline-block; } /* PƒÉstrƒÉm numerele mici */

        .user-link { color: #0c2461; cursor: pointer; text-decoration: underline; font-weight: bold; }
        .sub-label { font-size: 0.8em; color: #666; font-weight: bold; display: block; margin-bottom: 5px; }

        /* MODAL */
        #modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); overflow-y: auto; }
        .modal-content { background: white; margin: 5% auto; padding: 15px; width: 95%; border-radius: 10px; position: relative; }

        /* --- MEDIA QUERIES PENTRU TELEFON (MOD PORTRET) --- */
        @media (max-width: 768px) {
            .admin-grid { 
                grid-template-columns: 1fr; /* O singurƒÉ coloanƒÉ pe mobil */
            }
            
            div[style*="border-right"] {
                border-right: none !important;
                border-bottom: 1px solid #eee;
                padding-bottom: 15px;
                padding-right: 0 !important;
            }

            .container { padding: 10px; }
            
            h1 { font-size: 1.3rem; }

            /* AjustƒÉm tabelele sƒÉ nu for»õeze lƒÉ»õimea paginii */
            table { font-size: 0.75rem; }
            th, td { padding: 5px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üèÜ Predictor CM 2026</h1>

    <div class="section">
        <div class="admin-grid">
            <div style="border-right: 1px solid #eee; padding-right: 10px;">
                <h3>Utilizatori</h3>
                <input type="text" id="userName" placeholder="Nume nou">
                <button onclick="addUser()">AdaugƒÉ</button>
                <div id="manageUsersList" style="margin-top: 10px; max-height: 120px; overflow-y: auto; border: 1px solid #eee; padding: 5px;"></div>
            </div>
            <div>
                <h3>Meciuri</h3>
                <span class="sub-label">SelecteazƒÉ Meci:</span>
                <select id="matchRenameSelect"></select>
                <input type="text" id="newName" placeholder="Nume Nou (ex: Mexic - Italia)">
                <button onclick="renameMatch()">Redenume»ôte</button>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Introducere Rezultate</h2>
        <div class="input-group-container">
            <div class="input-box">
                <strong>1. Rezultat Real (Admin)</strong>
                <select id="matchSelectAdmin"></select>
                <div style="text-align:center; margin: 10px 0;">
                    <input type="number" id="realHome" value="0"> : <input type="number" id="realAway" value="0">
                </div>
                <span class="sub-label">Penalty:</span>
                <select id="realPenalty"><option value="NU">NU</option><option value="DA">DA</option></select>
                <button onclick="updateMatchResult()" class="btn-danger">SalveazƒÉ Rezultat</button>
            </div>
            
            <div class="input-box">
                <strong>2. Implementare Pariu</strong>
                <span class="sub-label">Utilizator & Meci:</span>
                <select id="userSelect"></select>
                <select id="matchSelectUser"></select>
                
                <span class="sub-label">Scor Corect:</span>
                <div style="text-align:center; margin: 5px 0;">
                    <input type="number" id="betHome" value="0" min="0" oninput="autoSelectSign()"> : 
                    <input type="number" id="betAway" value="0" min="0" oninput="autoSelectSign()">
                </div>
                
                <span class="sub-label">Pronostic (1X2):</span>
                <select id="betSign">
                    <option value="1">1</option>
                    <option value="X" selected>X</option>
                    <option value="2">2</option>
                </select>
                
                <span class="sub-label">Penalty:</span>
                <select id="betPenalty"><option value="NU">NU</option><option value="DA">DA</option></select>
                <button onclick="placeBet()">SalveazƒÉ Pariu</button>
            </div>
        </div>
    </div>

    <div class="section" style="text-align: center;">
        <button onclick="showFullReport()" style="background-color: #6c5ce7; margin-bottom: 10px;">üîç Raport General</button>
        <button onclick="exportData()" class="btn-export">üì• ExportƒÉ .TXT</button>
    </div>

    <div class="section">
        <h2>üìä Clasament Live</h2>
        <div class="table-wrapper">
            <table id="leaderboard">
                <thead>
                    <tr>
                        <th>Loc</th>
                        <th>Utilizator</th>
                        <th>Total</th>
                        <th>Scor</th>
                        <th>Pen</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<div id="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">Detalii</h2>
        <div id="userDetailsContent" class="table-wrapper"></div>
    </div>
</div>

<script>
    // Logica JavaScript rƒÉm√¢ne identicƒÉ cu cea anterioarƒÉ
    let users = JSON.parse(localStorage.getItem('wc2026_final_v4_users')) || [];
    let matches = JSON.parse(localStorage.getItem('wc2026_final_v4_matches')) || [];

    if (matches.length === 0) {
        for (let i = 1; i <= 72; i++) matches.push({ id: i, name: `Meciul ${i}`, realScore: null, realPenalty: null });
    }

    function init() { populateMatchDropdowns(); updateUserInterface(); calculateScores(); }

    function autoSelectSign() {
        const home = parseInt(document.getElementById('betHome').value) || 0;
        const away = parseInt(document.getElementById('betAway').value) || 0;
        const signSelect = document.getElementById('betSign');
        if (home > away) signSelect.value = "1";
        else if (home < away) signSelect.value = "2";
        else signSelect.value = "X";
    }

    function populateMatchDropdowns() {
        const ids = ['matchRenameSelect', 'matchSelectAdmin', 'matchSelectUser'];
        ids.forEach(id => {
            const sel = document.getElementById(id);
            const val = sel.value;
            sel.innerHTML = matches.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
            if(val) sel.value = val;
        });
    }

    function addUser() {
        const name = document.getElementById('userName').value.trim();
        if (name && !users.find(u => u.name === name)) {
            users.push({ name: name, bets: {}, totalPoints: 0, scorePoints: 0, penaltyPoints: 0 });
            save(); updateUserInterface();
            document.getElementById('userName').value = '';
        }
    }

    function removeUser(name) { if(confirm(`»òtergi utilizatorul ${name}?`)) { users = users.filter(u => u.name !== name); save(); updateUserInterface(); } }

    function updateUserInterface() {
        document.getElementById('userSelect').innerHTML = users.map(u => `<option value="${u.name}">${u.name}</option>`).join('');
        document.getElementById('manageUsersList').innerHTML = users.map(u => `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><span>${u.name}</span> <button onclick="removeUser('${u.name}')" class="btn-danger" style="width:auto; padding:2px 8px; font-size:10px;">X</button></div>`).join('');
    }

    function renameMatch() {
        const id = document.getElementById('matchRenameSelect').value;
        const n = document.getElementById('newName').value.trim();
        if (n) { matches.find(m => m.id == id).name = n; save(); populateMatchDropdowns(); }
    }

    function placeBet() {
        const u = users.find(u => u.name === document.getElementById('userSelect').value);
        if (u) {
            u.bets[document.getElementById('matchSelectUser').value] = {
                home: parseInt(document.getElementById('betHome').value) || 0,
                away: parseInt(document.getElementById('betAway').value) || 0,
                sign: document.getElementById('betSign').value,
                penalty: document.getElementById('betPenalty').value
            };
            save(); alert("Pariu salvat!");
        }
    }

    function updateMatchResult() {
        const m = matches.find(m => m.id == document.getElementById('matchSelectAdmin').value);
        const h = parseInt(document.getElementById('realHome').value) || 0;
        const a = parseInt(document.getElementById('realAway').value) || 0;
        m.realScore = { home: h, away: a, sign: (h>a?"1":h<a?"2":"X") };
        m.realPenalty = document.getElementById('realPenalty').value;
        save(); alert("Rezultat oficial salvat!");
    }

    function calculateScores() {
        users.forEach(u => {
            u.totalPoints = 0; u.scorePoints = 0; u.penaltyPoints = 0;
            Object.keys(u.bets).forEach(mId => {
                const b = u.bets[mId]; const r = matches.find(m => m.id == mId);
                if (r && r.realScore) {
                    if (b.home === r.realScore.home && b.away === r.realScore.away) { u.scorePoints += 3; u.totalPoints += 3; }
                    if (b.sign === r.realScore.sign) u.totalPoints += 1;
                    if (b.penalty === r.realPenalty) { u.penaltyPoints += (b.penalty === "DA" ? 2 : 1); u.totalPoints += (b.penalty === "DA" ? 2 : 1); }
                }
            });
        });
        renderLeaderboard();
    }

    function renderLeaderboard() {
        const tbody = document.querySelector('#leaderboard tbody');
        const sorted = [...users].sort((a, b) => (b.totalPoints - a.totalPoints) || (b.scorePoints - a.scorePoints) || (b.penaltyPoints - a.penaltyPoints));
        tbody.innerHTML = sorted.map((u, i) => `
            <tr>
                <td>${i+1}</td>
                <td><span class="user-link" onclick="showUserDetails('${u.name}')">${u.name}</span></td>
                <td><strong>${u.totalPoints}</strong></td>
                <td>${u.scorePoints}</td>
                <td>${u.penaltyPoints}</td>
            </tr>`).join('');
    }

    function showFullReport() {
        let h = `<table><tr><th>User</th><th>Meci</th><th>Pariu</th><th>Real</th><th>Pts</th></tr>`;
        users.forEach(u => {
            matches.forEach(m => {
                if(u.bets[m.id]) {
                    const b = u.bets[m.id]; const r = m.realScore;
                    let p = 0; if(r){ if(b.home===r.home && b.away===r.away)p+=3; if(b.sign===r.sign)p+=1; if(b.penalty===m.realPenalty)p+=(b.penalty==="DA"?2:1); }
                    h += `<tr><td>${u.name}</td><td>${m.name}</td><td>${b.home}-${b.away} | ${b.sign}</td><td>${r?r.home+'-'+r.away:'?'}</td><td>${p}</td></tr>`;
                }
            });
        });
        document.getElementById('userDetailsContent').innerHTML = h + `</table>`;
        document.getElementById('modal').style.display = "block";
    }

    function exportData() {
        let t = "RAPORT PREDICTOR\n";
        users.forEach(u => t += `${u.name}: ${u.totalPoints} pts\n`);
        const blob = new Blob([t], { type: 'text/plain' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Raport_CM2026.txt'; a.click();
    }

    function showUserDetails(n) {
        const u = users.find(x => x.name === n);
        let h = `<table><tr><th>Meci</th><th>Pariu</th><th>Real</th><th>Pts</th></tr>`;
        matches.forEach(m => { if(u.bets[m.id]) { 
            const b = u.bets[m.id]; const r = m.realScore; let p = 0;
            if(r){ if(b.home===r.home && b.away===r.away) p+=3; if(b.sign===r.sign) p+=1; if(b.penalty===m.realPenalty) p+=(b.penalty==="DA"?2:1); }
            h += `<tr><td>${m.name}</td><td>${b.home}-${b.away} | ${b.sign}</td><td>${r?r.home+'-'+r.away:'?'}</td><td>${p}</td></tr>`;
        }});
        document.getElementById('userDetailsContent').innerHTML = h + `</table>`;
        document.getElementById('modal').style.display = "block";
    }

    function save() { localStorage.setItem('wc2026_final_v4_users', JSON.stringify(users)); localStorage.setItem('wc2026_final_v4_matches', JSON.stringify(matches)); calculateScores(); }
    function closeModal() { document.getElementById('modal').style.display = "none"; }
    init();
</script>

</body>
</html>
